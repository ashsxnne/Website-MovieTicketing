<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buy Ticket - Movie Ticket Booking</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #fff9f8;
      margin: 0;
      color: #333;
    }
    header {
      background-color: #e23020;
      padding: 15px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }
    .logo {
      color: white;
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 1px;
      user-select: none;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      gap: 25px;
    }
    nav ul li {
      display: inline;
    }
    nav ul li a {
      color: white;
      text-decoration: none;
      font-weight: 700;
      padding: 5px 8px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }
    nav ul li a:hover,
    nav ul li a.active {
      background-color: #b31a17;
    }

    h1 {
      color: #e23020;
      font-weight: 700;
      margin-bottom: 25px;
      text-align: center;
    }
    label {
      display: block;
      margin: 15px 0 6px;
      font-weight: 600;
    }
    select, input[type="number"] {
      width: 100%;
      max-width: 300px;
      padding: 8px 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .seats-container {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      max-width: 300px;
      gap: 8px;
    }
    .seat {
      width: 35px;
      height: 35px;
      background-color: #eee;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    .seat.selected {
      background-color: #e23020;
      color: white;
    }
    .seat.unavailable {
      background-color: #ccc;
      cursor: not-allowed;
      color: #666;
    }
    .booking-fee {
      margin-top: 25px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #e23020;
    }
    button.book-btn {
      margin-top: 30px;
      background-color: #e23020;
      color: white;
      border: none;
      padding: 14px 40px;
      font-size: 1.2rem;
      font-weight: 700;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: block;
      width: 100%;
      max-width: 320px;
    }
    button.book-btn:hover {
      background-color: #b31a17;
    }
    .note {
      font-size: 0.9rem;
      color: #555;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-container">
      <div class="logo">
        Movie<span style="font-weight:400;">Ticket Booking</span>
      </div>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="movies.html">Movies</a></li>
          <li><a href="logout.html">Logout</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container">
    <h1>Buy Tickets</h1>

    <form id="bookingForm">
      <label for="movieSelect">Select Movie</label>
      <select id="movieSelect" required>
        <option value="" disabled selected>-- Choose a movie --</option>
      </select>

      <label for="dateSelect">Select Date</label>
      <select id="dateSelect" required disabled>
        <option value="" disabled selected>-- Select a date --</option>
      </select>

      <label for="timeSelect">Select Showtime</label>
      <select id="timeSelect" required disabled>
        <option value="" disabled selected>-- Select a time --</option>
      </select>

      <label>Select Seats <span class="note">(Click to select, max 5 seats)</span></label>
      <div class="seats-container" id="seatsContainer">
        <!-- seats generated by JS -->
      </div>

      <label for="quantity">Number of Tickets</label>
      <input type="number" id="quantity" name="quantity" min="1" max="5" value="1" required readonly />

      <div class="booking-fee" id="bookingFee">Booking Fee: ₱0</div>

      <button type="submit" class="book-btn">Book Now</button>
    </form>
  </div>

  <script>
    // Data structure: movies -> dates -> times -> seats availability
    const moviesData = {
      "Detective Conan The Movie": {
        dates: {
          "2025-10-06": {
            times: {
              "19:00": {
                seats: generateSeats(["A1", "A3", "B5"]) // These seats are unavailable
              },
              "21:00": {
                seats: generateSeats(["C1", "C2", "D4"])
              }
            }
          },
          "2025-10-07": {
            times: {
              "18:00": {
                seats: generateSeats(["A2", "B1", "B2"])
              }
            }
          }
        }
      },
      "100 Awit Para Kay Stella": {
        dates: {
          "2025-10-06": {
            times: {
              "17:30": {
                seats: generateSeats(["A5", "B3", "B4"])
              }
            }
          }
        }
      }
    };

    const BOOKING_FEE_PER_TICKET = 50; // Example fee

    const movieSelect = document.getElementById("movieSelect");
    const dateSelect = document.getElementById("dateSelect");
    const timeSelect = document.getElementById("timeSelect");
    const seatsContainer = document.getElementById("seatsContainer");
    const quantityInput = document.getElementById("quantity");
    const bookingFeeDisplay = document.getElementById("bookingFee");
    const bookingForm = document.getElementById("bookingForm");

    let selectedSeats = [];

    // Utility to generate seats: returns an object { seatLabel: availabilityBool }
    // unavailableSeats is an array of seat labels which are taken
    function generateSeats(unavailableSeats=[]) {
      const rows = ['A','B','C','D','E'];
      const seatsPerRow = 8;
      const seats = {};
      for(let r of rows){
        for(let i=1; i<=seatsPerRow; i++){
          const seatLabel = r+i;
          seats[seatLabel] = !unavailableSeats.includes(seatLabel);
        }
      }
      return seats;
    }

    // Populate movie dropdown
    function populateMovies(){
      Object.keys(moviesData).forEach(movie => {
        const option = document.createElement('option');
        option.value = movie;
        option.textContent = movie;
        movieSelect.appendChild(option);
      });
    }

    // Populate dates dropdown based on selected movie
    function populateDates(){
      dateSelect.innerHTML = '<option value="" disabled selected>-- Select a date --</option>';
      timeSelect.innerHTML = '<option value="" disabled selected>-- Select a time --</option>';
      timeSelect.disabled = true;
      seatsContainer.innerHTML = '';
      selectedSeats = [];
      quantityInput.value = 1;
      bookingFeeDisplay.textContent = `Booking Fee: ₱0`;
      quantityInput.readOnly = true;

      if (!movieSelect.value) {
        dateSelect.disabled = true;
        return;
      }
      const dates = Object.keys(moviesData[movieSelect.value].dates);
      dates.forEach(date => {
        const option = document.createElement('option');
        option.value = date;
        const formattedDate = new Date(date).toLocaleDateString(undefined, {weekday:'long', year:'numeric', month:'long', day:'numeric'});
        option.textContent = formattedDate;
        dateSelect.appendChild(option);
      });
      dateSelect.disabled = false;
    }

    // Populate times dropdown based on selected date
    function populateTimes(){
      timeSelect.innerHTML = '<option value="" disabled selected>-- Select a time --</option>';
      seatsContainer.innerHTML = '';
      selectedSeats = [];
      quantityInput.value = 1;
      bookingFeeDisplay.textContent = `Booking Fee: ₱0`;
      quantityInput.readOnly = true;

      if(!dateSelect.value){
        timeSelect.disabled = true;
        return;
      }
      const times = Object.keys(moviesData[movieSelect.value].dates[dateSelect.value].times);
      times.forEach(time => {
        const option = document.createElement('option');
        option.value = time;
        option.textContent = formatTime(time);
        timeSelect.appendChild(option);
      });
      timeSelect.disabled = false;
    }

    // Format time "HH:MM" 24-hour to 12-hour format
    function formatTime(timeStr) {
      const [h,m] = timeStr.split(':');
      let hour = parseInt(h);
      const ampm = hour >= 12 ? 'PM' : 'AM';
      hour = hour % 12 || 12;
      return `${hour}:${m} ${ampm}`;
    }

    // Display seats for selected showtime
    function displaySeats(){
      seatsContainer.innerHTML = '';
      selectedSeats = [];
      quantityInput.value = 1;
      bookingFeeDisplay.textContent = `Booking Fee: ₱0`;
      quantityInput.readOnly = true;

      if(!timeSelect.value) return;

      const seats = moviesData[movieSelect.value].dates[dateSelect.value].times[timeSelect.value].seats;
      for(const seatLabel in seats){
        const seatEl = document.createElement('div');
        seatEl.classList.add('seat');
        seatEl.textContent = seatLabel;
        if(!seats[seatLabel]) seatEl.classList.add('unavailable');

        seatEl.addEventListener('click', () => {
          if(seatEl.classList.contains('unavailable')) return;

          if(seatEl.classList.contains('selected')){
            seatEl.classList.remove('selected');
            selectedSeats = selectedSeats.filter(s => s !== seatLabel);
          } else {
            if(selectedSeats.length >= 5){
              alert('You can select a maximum of 5 seats.');
              return;
            }
            seatEl.classList.add('selected');
            selectedSeats.push(seatLabel);
          }
          quantityInput.value = selectedSeats.length || 1;
          updateBookingFee();
        });

        seatsContainer.appendChild(seatEl);
      }
    }

    function updateBookingFee(){
      const fee = selectedSeats.length * BOOKING_FEE_PER_TICKET;
      bookingFeeDisplay.textContent = `Booking Fee: ₱${fee}`;
    }

    // Event Listeners
    movieSelect.addEventListener('change', () => {
      populateDates();
    });

    dateSelect.addEventListener('change', () => {
      populateTimes();
    });

    timeSelect.addEventListener('change', () => {
      displaySeats();
    });

    bookingForm.addEventListener('submit', (e) => {
      e.preventDefault();
      if(selectedSeats.length === 0){
        alert('Please select at least one seat to proceed.');
        return;
      }

      // Booking details could be sent to server or stored locally here
      alert(`Booking Confirmed!\n\nMovie: ${movieSelect.value}\nDate: ${new Date(dateSelect.value).toLocaleDateString()}\nTime: ${formatTime(timeSelect.value)}\nSeats: ${selectedSeats.join(', ')}\nBooking Fee: ₱${selectedSeats.length * BOOKING_FEE_PER_TICKET}`);

      // Redirect to thank you page
      window.location.href = 'thankyou.html';
    });

    // Initialize
    populateMovies();
  </script>
</body>
</html>
